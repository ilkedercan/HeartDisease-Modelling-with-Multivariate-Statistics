---
title: "Diskriminant Analizi"
author: "ilke"
date: "2024-01-29"
output: html_document
---

## 1. Kütüphanelerin Yüklenmesi

```{r, warning=FALSE, message=FALSE}
library(readr)
library(tidyverse)
library(tidyr)
library(dendextend)
library(knitr)
library(gridExtra)
library(ggplot2)
library(VIM)
library(corrplot)
library(car)
library(ResourceSelection)
library(glmulti)
library(tree)
library(randomForest)
library(ISLR)
library(class)
library(pROC)
library(gtools)
library(tidyverse)
library(GGally)
library(superml)
library(caret)
library(Boruta)
library("stringr")
library("tidyr")
library("readr")
library("here")
library("skimr")
library("janitor")
library("lubridate")
library(gridExtra)
library(ggplot2)
library(VIM)
library(corrplot)
library(car)
library(ResourceSelection)
library(glmulti)
library(tree)
library(randomForest)
library(ISLR)
library(class)
library(pROC)
library(gtools)
library(tidyverse)
library("scales")
library("ggcorrplot")
library("ggrepel")
library("forcats")
library("corrgram")
library(tidymodels)
library(baguette)
library(discrim)
library(bonsai)
library(ResourceSelection)
library(kableExtra)
library(broom)
library(dplyr)
library(caret)
library(tidyr)
library(corrplot)
library("Hmisc")
library(psych)
library(factoextra)
library("DescTools")
library(ResourceSelection)
library(haven)
library(effectsize)
library(rstatix)
library(ggpubr)
library(biotools)
library(PerformanceAnalytics)
library(heplots)
library(gplots)
```

```{r,warning=FALSE,message=FALSE}
clean_df <- read.csv('/home/ilke/Downloads/clean_heart.csv')
```

## 2. Diskriminant Analizi

**Bu analiz için MaxHR,Age ve Cholesterol değişkenleri kullanıldı. Bağımsız değişkenler bağımlı değişkenin bütün gruplarında normal dağılım göstermektedir.çok değişkenli normallik testi için de normal dağıldığı söylenebilir.**


**Bağımsız değişkenleri arasında çoklu doğrusallık (multicollinearity) yoktur. (0.70denküçük)**
```{r}
target_df <- clean_df[, c("Age","Cholesterol","MaxHR","HeartDisease")]

corrplot(cor(target_df[,-4], method = "spearman"), method="number") 
```

```{r}
target_df %>% 
  dplyr::select(!c(HeartDisease)) %>%
  mshapiro_test()
```


```{r}

boxM(target_df[,-4], target_df$HeartDisease)
```
```{r}
lda_heart <- lda(HeartDisease ~ Age+Cholesterol+MaxHR, data=target_df) 
lda_heart
```

```{r}
#constant:
cons<-apply(target_df[,-4], 2, mean)
(-cons)%*%(lda_heart$scaling)
```

Y = 1.44 + 0.044Age + 0.004Cholesterol + -0.034MaxHR

```{r}
#Grup tahmini yapilmasi
lda_pred <- predict(lda_heart)
lda_pred$class # Sinifatamalari 

#Diskriminant skorları için
#lda_pred$x
```

```{r}
#plots
#ldahist(lda_pred$x, g = target_df$HeartDisease)
```


**Tablo göre, ayırma fonksiyonu kalp hastalığı olmayanları yüzde 70.3, Kalp hastalığı olanları yüzde 69 oranında doğru sınıflandırdı. Ortalama doğru sınıflandırma oranı yüzde 70’dir.**

```{r}
tablo<-table(target_df$HeartDisease,lda_pred$class)
tablo
```

```{r}
classrate<-sum(diag(tablo))/sum(tablo)
classrate
```

```{r}
#Nispi sans kriteri p1^2+p^2
lda_heart$prior[1]^2 + lda_heart$prior[2]^2
```

```{r}
#Orjinal gruplar ile Tahmin edilen grupların karşılaştırılması
comp<-cbind(target_df$HeartDisease,lda_pred$class) 
```



**Tablo yer alan ANOVA değerleri (p<.05), bağımlı değişken grupları arasında bağımsız değişken ortalamaları açısından anlamlı fark olduğunu gösteriyor. Wilks’ Lambdaya bakılarak ayrım için en kuvvetli değişkenin MaxHr olduğu söylenebilir.**
```{r}
##Stepwise 
#install.packages(klaR)
library(klaR)
heartstep<-greedy.wilks(HeartDisease~.,data=target_df)
heartstep$results
```
