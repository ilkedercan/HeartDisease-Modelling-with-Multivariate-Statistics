---
title: "PCA(Temel Bileşenler Analizi)"
author: "ilke"
date: "2024-01-29"
output: html_document
---

## 1. Kütüphanelerin Yüklenmesi
```{r, warning=FALSE, message=FALSE}
library(readr)
library(tidyverse)
library(tidyr)
library(dendextend)
library(knitr)
library(gridExtra)
library(ggplot2)
library(VIM)
library(corrplot)
library(car)
library(ResourceSelection)
library(glmulti)
library(tree)
library(randomForest)
library(ISLR)
library(class)
library(pROC)
library(gtools)
library(tidyverse)
library(GGally)
library(superml)
library(caret)
library(Boruta)
library("stringr")
library("tidyr")
library("readr")
library("here")
library("skimr")
library("janitor")
library("lubridate")
library(gridExtra)
library(ggplot2)
library(VIM)
library(corrplot)
library(car)
library(ResourceSelection)
library(glmulti)
library(tree)
library(randomForest)
library(ISLR)
library(class)
library(pROC)
library(gtools)
library(tidyverse)
library("scales")
library("ggcorrplot")
library("ggrepel")
library("forcats")
library("corrgram")
library(tidymodels)
library(baguette)
library(discrim)
library(bonsai)
library(ResourceSelection)
library(kableExtra)
library(broom)
library(dplyr)
library(caret)
library(tidyr)
library(corrplot)
library("Hmisc")
library(psych)
library(factoextra)
library("DescTools")
library(ResourceSelection)
library(haven)
library(effectsize)
library(rstatix)
library(ggpubr)
library(biotools)
library(PerformanceAnalytics)
library(heplots)
library(gplots)
```


```{r,warning=FALSE,message=FALSE}
clean_df <- read.csv('/home/ilke/Downloads/clean_heart.csv')
```


**Verideki Cholesterol, MaxHR, Age, Oldpeak, RestingBP değişkenleri kullanılarak analiz gerçekleştirildi.**

**TBA, ancak orijinal değişkenler birbirleri ile yeterince korelasyon gösteriyorsa anlamlı olur. Korelasyon matrislerine bakıldı ve 0.30’dan daha az ilişkiye sahip değişkenler var. Barlett’s testi sonuçlarına göre çıkarılıp çıkarılmayacağına karar verilecek.**

```{r,warning=FALSE,message=FALSE}
selected_columns <- clean_df[, c("Age","RestingBP","Cholesterol","MaxHR","Oldpeak")]

chart.Correlation(selected_columns, histogram=TRUE, pch=19)
```

```{r}
correlation_matrix <- cor(selected_columns)
corrplot(correlation_matrix, method = "circle")
```

```{r}
rcorr(as.matrix(selected_columns),type="pearson")
```


**KMO testi sonucuna (.65) göre örneklem uygunluğu orta düzeydedir. Bartlett's Testi sonucuna göre ise (p<.001) değişkenler arasındaki korelasyonlar Temel Bileşenler Analizi yapabilmek için uygun düzeydedir. Bu yüzden hiçbir değişken çıkarılmadı.**
```{r}
#PCA UYGULANABİLİRLİGİ (KMO - ANTİ-IMAGE - BARTLETT TEST)
library(psych)
KMO(clean_df[, c("Age","RestingBP","Cholesterol","MaxHR","Oldpeak")])
```


```{r}
#Bartlett Küresellik Testi(Bartlett's Test of Spherecity) 
cortest.bartlett(cor(clean_df[, c("Age","RestingBP","Cholesterol","MaxHR","Oldpeak")]),nrow(clean_df)) #Bartlett test 
```

```{r}
#Temel Bilesenler Analizi- princomp fonksiyonu
fit.pca <- prcomp( ~., data=selected_columns, scale=TRUE) # korelasyon matrisi icin scale=TRUE yaz 
fit.pca$rotation #loadings
#fit.pca$x #scores
```

```{r}
summary(fit.pca)
(fit.pca$sdev)^2 #ozdegerler
```

```{r}
((fit.pca$sdev)^2)/5 #varyans acıklama oranları 
```


```{r}
#Scree plot
plot(fit.pca)
plot(fit.pca,type="line")
#ya da 
library(factoextra)
scree <- fviz_eig(fit.pca)
scree
```

**Y1= 0.569Age+0.40RestingBP+0.137Cholesterol-0.51MaxHR+0.48Oldpeak**
**Y2= -0.09Age+0.29RestingBP+0.89Cholesterol+0.33MaxHR-0.029Oldpeak**
```{r}
#ilk iki bilesene karar verildi:
fit.pca$rotation[,1:2] #loadings
```

```{r}
fit.pca$rotation[,2]*fit.pca$sdev[2] 
```

```{r}
library(factoextra)
fviz_pca_var(fit.pca,col.var="steelblue",
             repel = TRUE # Avoid text overlapping
)
```

**Bu durumda, beş farklı değişkenin (Age, RestingBP, Cholesterol, MaxHR, Oldpeak) orijinal veri setinin bir kombinasyonu olan iki temel bileşen (PC1 ve PC2) elde edilmiştir.**

**Bu denklemler, orijinal değişkenlerin bir kombinasyonu olan temel bileşenlerin anlamlarını sağlar. Özellikle, bir değişkenin katsayısı büyükse, o değişken temel bileşenin oluşumundaki önemli bir rol oynar.**

**Y1= 0.569Age+0.40RestingBP+0.137Cholesterol-0.51MaxHR+0.48Oldpeak**
**Y2= -0.09Age+0.29RestingBP+0.89Cholesterol+0.33MaxHR-0.029Oldpeak**

**→ PC1 (Principal Component 1):**

**o Pozitif ağırlıklı en yüksek katsayı, "Age" değişkenine aittir, bu da demektir ki PC1 artarken yaşın etkisi de artmaktadır.**
**o "RestingBP", "Cholesterol", ve "Oldpeak" değişkenleri de pozitif ağırlıklıdır, buda bu değişkenlerin PC1'in artışıyla birlikte arttığını gösterir.**
**o "MaxHR" değişkeni ise negatif ağırlıklıdır, bu da bu değişkenin PC1'in artışıyla birlikte azaldığını gösterir.**

**→ PC2 (Principal Component 2):**
**o "Age" değişkeni negatif ağırlıklıdır, bu da demektir ki PC2 arttıkça yaşın etkisi azalmaktadır.**
**o "RestingBP", "Cholesterol", ve "MaxHR" değişkenleri pozitif ağırlıklıdır, bu da bu değişkenlerin PC2'nin artışıyla birlikte arttığını gösterir.**
**o "Oldpeak" değişkeni negatif ağırlıklıdır, bu da bu değişkenin PC2'nin artışıyla birlikte azaldığını gösterir.**